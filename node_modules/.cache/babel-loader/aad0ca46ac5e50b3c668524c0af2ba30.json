{"ast":null,"code":"import \"antd/es/popover/style\";\nimport _Popover from \"antd/es/popover\";\nimport \"antd/es/input-number/style\";\nimport _InputNumber from \"antd/es/input-number\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nvar _excluded = [\"content\", \"numberFormatOptions\", \"numberPopoverRender\"],\n    _excluded2 = [\"text\", \"mode\", \"locale\", \"render\", \"renderFormItem\", \"fieldProps\", \"proFieldKey\", \"plain\", \"valueEnum\", \"placeholder\", \"customSymbol\", \"numberFormatOptions\", \"numberPopoverRender\"];\nimport React, { useMemo } from 'react';\nimport { useIntl, intlMap as allIntlMap } from '@ant-design/pro-provider';\nimport useMergedState from \"rc-util/es/hooks/useMergedState\";\nvar defaultMoneyIntl = new Intl.NumberFormat('zh-Hans-CN', {\n  currency: 'CNY',\n  style: 'currency'\n});\nvar enMoneyIntl = {\n  style: 'currency',\n  currency: 'USD'\n};\nvar ruMoneyIntl = {\n  style: 'currency',\n  currency: 'RUB'\n};\nvar rsMoneyIntl = {\n  style: 'currency',\n  currency: 'RSD'\n};\nvar msMoneyIntl = {\n  style: 'currency',\n  currency: 'MYR'\n};\nvar intlMap = {\n  default: defaultMoneyIntl,\n  'zh-Hans-CN': {\n    currency: 'CNY',\n    style: 'currency'\n  },\n  'en-US': enMoneyIntl,\n  'ru-RU': ruMoneyIntl,\n  'ms-MY': msMoneyIntl,\n  'sr-RS': rsMoneyIntl\n};\n\nvar getTextByLocale = function getTextByLocale(localeStr, paramsText, precision, config) {\n  var moneyText = paramsText;\n\n  if (typeof moneyText === 'string') {\n    moneyText = Number(moneyText);\n  }\n\n  return new Intl.NumberFormat(localeStr || 'zh-Hans-CN', _objectSpread(_objectSpread({}, intlMap[localeStr || 'zh-Hans-CN'] || intlMap['zh-Hans-CN']), {}, {\n    maximumFractionDigits: precision\n  }, config)).format(moneyText);\n};\n\nvar DefaultPrecisionCont = 2;\nvar InputNumberPopover = /*#__PURE__*/React.forwardRef(function (_ref, ref) {\n  var content = _ref.content,\n      numberFormatOptions = _ref.numberFormatOptions,\n      numberPopoverRender = _ref.numberPopoverRender,\n      rest = _objectWithoutProperties(_ref, _excluded);\n\n  var _useMergedState = useMergedState(function () {\n    return rest.defaultValue;\n  }, {\n    value: rest.value,\n    onChange: rest.onChange\n  }),\n      _useMergedState2 = _slicedToArray(_useMergedState, 2),\n      value = _useMergedState2[0],\n      onChange = _useMergedState2[1];\n\n  var dom = content === null || content === void 0 ? void 0 : content(_objectSpread(_objectSpread({}, rest), {}, {\n    value: value\n  }));\n  return /*#__PURE__*/React.createElement(_Popover, {\n    placement: \"topLeft\",\n    visible: dom ? undefined : false,\n    trigger: \"focus\",\n    content: dom,\n    getPopupContainer: function getPopupContainer(triggerNode) {\n      return (triggerNode === null || triggerNode === void 0 ? void 0 : triggerNode.parentElement) || document.body;\n    }\n  }, /*#__PURE__*/React.createElement(_InputNumber, _extends({\n    ref: ref\n  }, rest, {\n    value: value,\n    onChange: onChange\n  })));\n});\n/**\n * 金额组件\n *\n * @param FieldMoneyProps {\n *     text: number;\n *     moneySymbol?: string; }\n */\n\nvar FieldMoney = function FieldMoney(_ref2, ref) {\n  var _fieldProps$precision;\n\n  var text = _ref2.text,\n      type = _ref2.mode,\n      _ref2$locale = _ref2.locale,\n      locale = _ref2$locale === void 0 ? 'zh-Hans-CN' : _ref2$locale,\n      render = _ref2.render,\n      renderFormItem = _ref2.renderFormItem,\n      fieldProps = _ref2.fieldProps,\n      proFieldKey = _ref2.proFieldKey,\n      plain = _ref2.plain,\n      valueEnum = _ref2.valueEnum,\n      placeholder = _ref2.placeholder,\n      customSymbol = _ref2.customSymbol,\n      _ref2$numberFormatOpt = _ref2.numberFormatOptions,\n      numberFormatOptions = _ref2$numberFormatOpt === void 0 ? fieldProps === null || fieldProps === void 0 ? void 0 : fieldProps.numberFormatOptions : _ref2$numberFormatOpt,\n      _ref2$numberPopoverRe = _ref2.numberPopoverRender,\n      numberPopoverRender = _ref2$numberPopoverRe === void 0 ? (fieldProps === null || fieldProps === void 0 ? void 0 : fieldProps.numberPopoverRender) || false : _ref2$numberPopoverRe,\n      rest = _objectWithoutProperties(_ref2, _excluded2);\n\n  var precision = (_fieldProps$precision = fieldProps === null || fieldProps === void 0 ? void 0 : fieldProps.precision) !== null && _fieldProps$precision !== void 0 ? _fieldProps$precision : DefaultPrecisionCont;\n  var intl = useIntl(); // 当手动传入locale时，应该以传入的locale为准，未传入时则根据全局的locale进行国际化\n\n  if (locale && allIntlMap[locale]) {\n    intl = allIntlMap[locale];\n  }\n\n  var moneySymbol = useMemo(function () {\n    if (customSymbol) {\n      return customSymbol;\n    }\n\n    var defaultText = intl.getMessage('moneySymbol', '￥');\n\n    if (rest.moneySymbol === false || fieldProps.moneySymbol === false) {\n      return undefined;\n    }\n\n    return defaultText;\n  }, [fieldProps.moneySymbol, intl, rest.moneySymbol, customSymbol]);\n\n  if (type === 'read') {\n    var dom = /*#__PURE__*/React.createElement(\"span\", {\n      ref: ref\n    }, getTextByLocale(moneySymbol ? locale : false, text, precision, numberFormatOptions));\n\n    if (render) {\n      return render(text, _objectSpread({\n        mode: type\n      }, fieldProps), dom);\n    }\n\n    return dom;\n  }\n\n  if (type === 'edit' || type === 'update') {\n    var _dom = /*#__PURE__*/React.createElement(InputNumberPopover, _extends({\n      content: function content(props) {\n        if (numberPopoverRender === false) return;\n        if (!props.value) return;\n        var reg = new RegExp(\"/B(?=(d{\".concat(3 + (precision - DefaultPrecisionCont), \"})+(?!d))/g\"));\n        var localeText = getTextByLocale(moneySymbol ? locale : false, props.value.toString().replace(reg, ','), precision, _objectSpread(_objectSpread({}, numberFormatOptions), {}, {\n          notation: 'compact'\n        }));\n\n        if (typeof numberPopoverRender === 'function') {\n          return numberPopoverRender === null || numberPopoverRender === void 0 ? void 0 : numberPopoverRender(props, localeText);\n        }\n\n        return localeText;\n      },\n      ref: ref,\n      precision: precision // 删除默认min={0}，允许输入一个负数的金额，用户可自行配置min来限制是否允许小于0的金额\n      ,\n      formatter: function formatter(value) {\n        if (value && moneySymbol) {\n          var reg = new RegExp(\"/B(?=(d{\".concat(3 + (precision - DefaultPrecisionCont), \"})+(?!d))/g\"));\n          return \"\".concat(moneySymbol, \" \").concat(value).replace(reg, ',');\n        }\n\n        if (value) {\n          return value;\n        }\n\n        return '';\n      },\n      parser: function parser(value) {\n        if (moneySymbol && value) {\n          return value.replace(new RegExp(\"\\\\\".concat(moneySymbol, \"\\\\s?|(,*)\"), 'g'), '');\n        }\n\n        if (value) {\n          return value;\n        }\n\n        return '';\n      },\n      placeholder: placeholder\n    }, fieldProps));\n\n    if (renderFormItem) {\n      return renderFormItem(text, _objectSpread({\n        mode: type\n      }, fieldProps), _dom);\n    }\n\n    return _dom;\n  }\n\n  return null;\n};\n\nexport default /*#__PURE__*/React.forwardRef(FieldMoney);","map":{"version":3,"sources":["C:/web/my-app/node_modules/@ant-design/pro-field/es/components/Money/index.js"],"names":["_Popover","_InputNumber","_extends","_slicedToArray","_objectWithoutProperties","_objectSpread","_excluded","_excluded2","React","useMemo","useIntl","intlMap","allIntlMap","useMergedState","defaultMoneyIntl","Intl","NumberFormat","currency","style","enMoneyIntl","ruMoneyIntl","rsMoneyIntl","msMoneyIntl","default","getTextByLocale","localeStr","paramsText","precision","config","moneyText","Number","maximumFractionDigits","format","DefaultPrecisionCont","InputNumberPopover","forwardRef","_ref","ref","content","numberFormatOptions","numberPopoverRender","rest","_useMergedState","defaultValue","value","onChange","_useMergedState2","dom","createElement","placement","visible","undefined","trigger","getPopupContainer","triggerNode","parentElement","document","body","FieldMoney","_ref2","_fieldProps$precision","text","type","mode","_ref2$locale","locale","render","renderFormItem","fieldProps","proFieldKey","plain","valueEnum","placeholder","customSymbol","_ref2$numberFormatOpt","_ref2$numberPopoverRe","intl","moneySymbol","defaultText","getMessage","_dom","props","reg","RegExp","concat","localeText","toString","replace","notation","formatter","parser"],"mappings":"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","sourcesContent":["import \"antd/es/popover/style\";\nimport _Popover from \"antd/es/popover\";\nimport \"antd/es/input-number/style\";\nimport _InputNumber from \"antd/es/input-number\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nvar _excluded = [\"content\", \"numberFormatOptions\", \"numberPopoverRender\"],\n    _excluded2 = [\"text\", \"mode\", \"locale\", \"render\", \"renderFormItem\", \"fieldProps\", \"proFieldKey\", \"plain\", \"valueEnum\", \"placeholder\", \"customSymbol\", \"numberFormatOptions\", \"numberPopoverRender\"];\nimport React, { useMemo } from 'react';\nimport { useIntl, intlMap as allIntlMap } from '@ant-design/pro-provider';\nimport useMergedState from \"rc-util/es/hooks/useMergedState\";\nvar defaultMoneyIntl = new Intl.NumberFormat('zh-Hans-CN', {\n  currency: 'CNY',\n  style: 'currency'\n});\nvar enMoneyIntl = {\n  style: 'currency',\n  currency: 'USD'\n};\nvar ruMoneyIntl = {\n  style: 'currency',\n  currency: 'RUB'\n};\nvar rsMoneyIntl = {\n  style: 'currency',\n  currency: 'RSD'\n};\nvar msMoneyIntl = {\n  style: 'currency',\n  currency: 'MYR'\n};\nvar intlMap = {\n  default: defaultMoneyIntl,\n  'zh-Hans-CN': {\n    currency: 'CNY',\n    style: 'currency'\n  },\n  'en-US': enMoneyIntl,\n  'ru-RU': ruMoneyIntl,\n  'ms-MY': msMoneyIntl,\n  'sr-RS': rsMoneyIntl\n};\n\nvar getTextByLocale = function getTextByLocale(localeStr, paramsText, precision, config) {\n  var moneyText = paramsText;\n\n  if (typeof moneyText === 'string') {\n    moneyText = Number(moneyText);\n  }\n\n  return new Intl.NumberFormat(localeStr || 'zh-Hans-CN', _objectSpread(_objectSpread({}, intlMap[localeStr || 'zh-Hans-CN'] || intlMap['zh-Hans-CN']), {}, {\n    maximumFractionDigits: precision\n  }, config)).format(moneyText);\n};\n\nvar DefaultPrecisionCont = 2;\nvar InputNumberPopover = /*#__PURE__*/React.forwardRef(function (_ref, ref) {\n  var content = _ref.content,\n      numberFormatOptions = _ref.numberFormatOptions,\n      numberPopoverRender = _ref.numberPopoverRender,\n      rest = _objectWithoutProperties(_ref, _excluded);\n\n  var _useMergedState = useMergedState(function () {\n    return rest.defaultValue;\n  }, {\n    value: rest.value,\n    onChange: rest.onChange\n  }),\n      _useMergedState2 = _slicedToArray(_useMergedState, 2),\n      value = _useMergedState2[0],\n      onChange = _useMergedState2[1];\n\n  var dom = content === null || content === void 0 ? void 0 : content(_objectSpread(_objectSpread({}, rest), {}, {\n    value: value\n  }));\n  return /*#__PURE__*/React.createElement(_Popover, {\n    placement: \"topLeft\",\n    visible: dom ? undefined : false,\n    trigger: \"focus\",\n    content: dom,\n    getPopupContainer: function getPopupContainer(triggerNode) {\n      return (triggerNode === null || triggerNode === void 0 ? void 0 : triggerNode.parentElement) || document.body;\n    }\n  }, /*#__PURE__*/React.createElement(_InputNumber, _extends({\n    ref: ref\n  }, rest, {\n    value: value,\n    onChange: onChange\n  })));\n});\n/**\n * 金额组件\n *\n * @param FieldMoneyProps {\n *     text: number;\n *     moneySymbol?: string; }\n */\n\nvar FieldMoney = function FieldMoney(_ref2, ref) {\n  var _fieldProps$precision;\n\n  var text = _ref2.text,\n      type = _ref2.mode,\n      _ref2$locale = _ref2.locale,\n      locale = _ref2$locale === void 0 ? 'zh-Hans-CN' : _ref2$locale,\n      render = _ref2.render,\n      renderFormItem = _ref2.renderFormItem,\n      fieldProps = _ref2.fieldProps,\n      proFieldKey = _ref2.proFieldKey,\n      plain = _ref2.plain,\n      valueEnum = _ref2.valueEnum,\n      placeholder = _ref2.placeholder,\n      customSymbol = _ref2.customSymbol,\n      _ref2$numberFormatOpt = _ref2.numberFormatOptions,\n      numberFormatOptions = _ref2$numberFormatOpt === void 0 ? fieldProps === null || fieldProps === void 0 ? void 0 : fieldProps.numberFormatOptions : _ref2$numberFormatOpt,\n      _ref2$numberPopoverRe = _ref2.numberPopoverRender,\n      numberPopoverRender = _ref2$numberPopoverRe === void 0 ? (fieldProps === null || fieldProps === void 0 ? void 0 : fieldProps.numberPopoverRender) || false : _ref2$numberPopoverRe,\n      rest = _objectWithoutProperties(_ref2, _excluded2);\n\n  var precision = (_fieldProps$precision = fieldProps === null || fieldProps === void 0 ? void 0 : fieldProps.precision) !== null && _fieldProps$precision !== void 0 ? _fieldProps$precision : DefaultPrecisionCont;\n  var intl = useIntl(); // 当手动传入locale时，应该以传入的locale为准，未传入时则根据全局的locale进行国际化\n\n  if (locale && allIntlMap[locale]) {\n    intl = allIntlMap[locale];\n  }\n\n  var moneySymbol = useMemo(function () {\n    if (customSymbol) {\n      return customSymbol;\n    }\n\n    var defaultText = intl.getMessage('moneySymbol', '￥');\n\n    if (rest.moneySymbol === false || fieldProps.moneySymbol === false) {\n      return undefined;\n    }\n\n    return defaultText;\n  }, [fieldProps.moneySymbol, intl, rest.moneySymbol, customSymbol]);\n\n  if (type === 'read') {\n    var dom = /*#__PURE__*/React.createElement(\"span\", {\n      ref: ref\n    }, getTextByLocale(moneySymbol ? locale : false, text, precision, numberFormatOptions));\n\n    if (render) {\n      return render(text, _objectSpread({\n        mode: type\n      }, fieldProps), dom);\n    }\n\n    return dom;\n  }\n\n  if (type === 'edit' || type === 'update') {\n    var _dom = /*#__PURE__*/React.createElement(InputNumberPopover, _extends({\n      content: function content(props) {\n        if (numberPopoverRender === false) return;\n        if (!props.value) return;\n        var reg = new RegExp(\"/B(?=(d{\".concat(3 + (precision - DefaultPrecisionCont), \"})+(?!d))/g\"));\n        var localeText = getTextByLocale(moneySymbol ? locale : false, props.value.toString().replace(reg, ','), precision, _objectSpread(_objectSpread({}, numberFormatOptions), {}, {\n          notation: 'compact'\n        }));\n\n        if (typeof numberPopoverRender === 'function') {\n          return numberPopoverRender === null || numberPopoverRender === void 0 ? void 0 : numberPopoverRender(props, localeText);\n        }\n\n        return localeText;\n      },\n      ref: ref,\n      precision: precision // 删除默认min={0}，允许输入一个负数的金额，用户可自行配置min来限制是否允许小于0的金额\n      ,\n      formatter: function formatter(value) {\n        if (value && moneySymbol) {\n          var reg = new RegExp(\"/B(?=(d{\".concat(3 + (precision - DefaultPrecisionCont), \"})+(?!d))/g\"));\n          return \"\".concat(moneySymbol, \" \").concat(value).replace(reg, ',');\n        }\n\n        if (value) {\n          return value;\n        }\n\n        return '';\n      },\n      parser: function parser(value) {\n        if (moneySymbol && value) {\n          return value.replace(new RegExp(\"\\\\\".concat(moneySymbol, \"\\\\s?|(,*)\"), 'g'), '');\n        }\n\n        if (value) {\n          return value;\n        }\n\n        return '';\n      },\n      placeholder: placeholder\n    }, fieldProps));\n\n    if (renderFormItem) {\n      return renderFormItem(text, _objectSpread({\n        mode: type\n      }, fieldProps), _dom);\n    }\n\n    return _dom;\n  }\n\n  return null;\n};\n\nexport default /*#__PURE__*/React.forwardRef(FieldMoney);"]},"metadata":{},"sourceType":"module"}