{"ast":null,"code":"import \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _excluded = [\"name\", \"children\", \"ignoreFormListField\"];\nimport React from \"react\";\nimport get from \"rc-util/es/utils/get\";\nimport { useContext, useMemo } from 'react';\nimport set from \"rc-util/es/utils/set\";\nimport { FormListContext } from '../List';\nimport { ProFormContext, merge } from '@ant-design/pro-utils';\n\nvar ProFormDependency = function ProFormDependency(_ref) {\n  var name = _ref.name,\n      children = _ref.children,\n      ignoreFormListField = _ref.ignoreFormListField,\n      rest = _objectWithoutProperties(_ref, _excluded);\n\n  var context = useContext(ProFormContext); // ProFromList 的 filed，里面有name和key\n\n  var formListField = useContext(FormListContext);\n  var names = useMemo(function () {\n    if (formListField.name === undefined) {\n      return name;\n    }\n\n    return name.map(function (itemName) {\n      return [formListField.listName, itemName].flat(1);\n    });\n  }, [formListField.listName, formListField.name, name]);\n  return /*#__PURE__*/React.createElement(_Form.Item, _extends({}, rest, {\n    noStyle: true,\n    shouldUpdate: function shouldUpdate(prevValues, nextValues) {\n      var finalNames = names; // ignoreFormListField 为 true 时，应从全局取值，要将 names 中各项的路径前缀(formListField.listName)剥离掉\n\n      if (ignoreFormListField && Array.isArray(formListField.listName) && formListField.listName.length > 0) {\n        finalNames = names.map(function (nameItem) {\n          return Array.isArray(nameItem) ? nameItem.slice(formListField.listName.length) : nameItem;\n        });\n      }\n\n      return finalNames.some(function (nameItem) {\n        var arrayName = Array.isArray(nameItem) ? nameItem : [nameItem];\n        return get(prevValues, arrayName) !== get(nextValues, arrayName);\n      });\n    }\n  }), function (form) {\n    // 不在 FormList 中时，返回声明的全局依赖值\n    if (formListField.name === undefined) {\n      var values = names.reduce(function (pre, next) {\n        var _context$getFieldsFor;\n\n        var value = context === null || context === void 0 ? void 0 : (_context$getFieldsFor = context.getFieldsFormatValue) === null || _context$getFieldsFor === void 0 ? void 0 : _context$getFieldsFor.call(context, [next]);\n        var noFormatValue = form.getFieldsValue([next]);\n        return merge({}, pre, noFormatValue, value);\n      }, {});\n      return children === null || children === void 0 ? void 0 : children(_objectSpread({}, values), form);\n    } // 在 FormList 中时\n    // ignoreFormListField === true 时取全局依赖值\n\n\n    if (ignoreFormListField) {\n      var _nameValues = name.reduce(function (pre, namePath) {\n        var finalNamePath = [namePath].flat(1);\n        var fieldValue = form.getFieldValue(finalNamePath);\n        return set(pre, [namePath].flat(1), fieldValue, false);\n      }, {});\n\n      return children === null || children === void 0 ? void 0 : children(_objectSpread({}, _nameValues), form);\n    } // ignoreFormListField === false 时，取局部依赖值\n\n\n    var nameValues = name.reduce(function (pre, namePath) {\n      var finalNamePath = [formListField.listName, namePath].flat(1);\n      var fieldValue = form.getFieldValue(finalNamePath);\n      return set(pre, [namePath].flat(1), fieldValue, false);\n    }, {});\n    return children === null || children === void 0 ? void 0 : children(_objectSpread({}, nameValues), form);\n  });\n};\n\nexport default ProFormDependency;","map":{"version":3,"sources":["C:/web/my-app/node_modules/@ant-design/pro-form/es/components/Dependency/index.js"],"names":["_Form","_extends","_objectSpread","_objectWithoutProperties","_excluded","React","get","useContext","useMemo","set","FormListContext","ProFormContext","merge","ProFormDependency","_ref","name","children","ignoreFormListField","rest","context","formListField","names","undefined","map","itemName","listName","flat","createElement","Item","noStyle","shouldUpdate","prevValues","nextValues","finalNames","Array","isArray","length","nameItem","slice","some","arrayName","form","values","reduce","pre","next","_context$getFieldsFor","value","getFieldsFormatValue","call","noFormatValue","getFieldsValue","_nameValues","namePath","finalNamePath","fieldValue","getFieldValue","nameValues"],"mappings":"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","sourcesContent":["import \"antd/es/form/style\";\nimport _Form from \"antd/es/form\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _excluded = [\"name\", \"children\", \"ignoreFormListField\"];\nimport React from \"react\";\nimport get from \"rc-util/es/utils/get\";\nimport { useContext, useMemo } from 'react';\nimport set from \"rc-util/es/utils/set\";\nimport { FormListContext } from '../List';\nimport { ProFormContext, merge } from '@ant-design/pro-utils';\n\nvar ProFormDependency = function ProFormDependency(_ref) {\n  var name = _ref.name,\n      children = _ref.children,\n      ignoreFormListField = _ref.ignoreFormListField,\n      rest = _objectWithoutProperties(_ref, _excluded);\n\n  var context = useContext(ProFormContext); // ProFromList 的 filed，里面有name和key\n\n  var formListField = useContext(FormListContext);\n  var names = useMemo(function () {\n    if (formListField.name === undefined) {\n      return name;\n    }\n\n    return name.map(function (itemName) {\n      return [formListField.listName, itemName].flat(1);\n    });\n  }, [formListField.listName, formListField.name, name]);\n  return /*#__PURE__*/React.createElement(_Form.Item, _extends({}, rest, {\n    noStyle: true,\n    shouldUpdate: function shouldUpdate(prevValues, nextValues) {\n      var finalNames = names; // ignoreFormListField 为 true 时，应从全局取值，要将 names 中各项的路径前缀(formListField.listName)剥离掉\n\n      if (ignoreFormListField && Array.isArray(formListField.listName) && formListField.listName.length > 0) {\n        finalNames = names.map(function (nameItem) {\n          return Array.isArray(nameItem) ? nameItem.slice(formListField.listName.length) : nameItem;\n        });\n      }\n\n      return finalNames.some(function (nameItem) {\n        var arrayName = Array.isArray(nameItem) ? nameItem : [nameItem];\n        return get(prevValues, arrayName) !== get(nextValues, arrayName);\n      });\n    }\n  }), function (form) {\n    // 不在 FormList 中时，返回声明的全局依赖值\n    if (formListField.name === undefined) {\n      var values = names.reduce(function (pre, next) {\n        var _context$getFieldsFor;\n\n        var value = context === null || context === void 0 ? void 0 : (_context$getFieldsFor = context.getFieldsFormatValue) === null || _context$getFieldsFor === void 0 ? void 0 : _context$getFieldsFor.call(context, [next]);\n        var noFormatValue = form.getFieldsValue([next]);\n        return merge({}, pre, noFormatValue, value);\n      }, {});\n      return children === null || children === void 0 ? void 0 : children(_objectSpread({}, values), form);\n    } // 在 FormList 中时\n    // ignoreFormListField === true 时取全局依赖值\n\n\n    if (ignoreFormListField) {\n      var _nameValues = name.reduce(function (pre, namePath) {\n        var finalNamePath = [namePath].flat(1);\n        var fieldValue = form.getFieldValue(finalNamePath);\n        return set(pre, [namePath].flat(1), fieldValue, false);\n      }, {});\n\n      return children === null || children === void 0 ? void 0 : children(_objectSpread({}, _nameValues), form);\n    } // ignoreFormListField === false 时，取局部依赖值\n\n\n    var nameValues = name.reduce(function (pre, namePath) {\n      var finalNamePath = [formListField.listName, namePath].flat(1);\n      var fieldValue = form.getFieldValue(finalNamePath);\n      return set(pre, [namePath].flat(1), fieldValue, false);\n    }, {});\n    return children === null || children === void 0 ? void 0 : children(_objectSpread({}, nameValues), form);\n  });\n};\n\nexport default ProFormDependency;"]},"metadata":{},"sourceType":"module"}