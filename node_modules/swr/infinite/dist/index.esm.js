import{useEffect as t,useLayoutEffect as n,useState as e,useRef as r,useCallback as u}from"react";import i from"swr";function o(t,n,e,r){return new(e||(e=Promise))(function(u,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?u(t.value):(n=t.value,n instanceof e?n:new e(function(t){t(n)})).then(o,a)}c((r=r.apply(t,n||[])).next())})}function a(t,n){var e,r,u,i,o={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(e)throw new TypeError("Generator is already executing.");for(;o;)try{if(e=1,r&&(u=2&i[0]?r.return:i[0]?r.throw||((u=r.return)&&u.call(r),0):r.next)&&!(u=u.call(r,i[1])).done)return u;switch(r=0,u&&(i=[2&i[0],u.value]),i[0]){case 0:case 1:u=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(u=o.trys,(u=u.length>0&&u[u.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!u||i[1]>u[0]&&i[1]<u[3])){o.label=i[1];break}if(6===i[0]&&o.label<u[1]){o.label=u[1],u=i;break}if(u&&o.label<u[2]){o.label=u[2],o.ops.push(i);break}u[2]&&o.ops.pop(),o.trys.pop();continue}i=n.call(t,o)}catch(t){i=[6,t],r=0}finally{e=u=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var c=function(){},l=c(),f=Object,s=function(t){return t===l},v=function(t){return"function"==typeof t},p=!("undefined"!=typeof window)||"Deno"in window,d=p?t:n,y="undefined"!=typeof navigator&&navigator.connection;!p&&y&&(["slow-2g","2g"].includes(y.effectiveType)||y.saveData);var g=new WeakMap,h=0,b=function(t){var n,e,r=typeof t,u=t&&t.constructor,i=u==Date;if(f(t)!==t||i||u==RegExp)n=i?t.toJSON():"symbol"==r?t.toString():"string"==r?JSON.stringify(t):""+t;else{if(n=g.get(t))return n;if(n=++h+"~",g.set(t,n),u==Array){for(n="@",e=0;e<t.length;e++)n+=b(t[e])+",";g.set(t,n)}if(u==f){n="#";for(var o=f.keys(t).sort();!s(e=o.pop());)s(t[e])||(n+=e+":"+b(t[e])+",");g.set(t,n)}}return n},w=function(t){if(v(t))try{t=t()}catch(n){t=""}var n=[].concat(t);return[t="string"==typeof t?t:(Array.isArray(t)?t.length:t)?b(t):"",n,t?"$err$"+t:"",t?"$req$"+t:""]},m=function(t){return v(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(null===t[1]?t[2]:t[1])||{}]},$=function(t){return w(t?t(0,null):null)[0]},x=function(t){return"$inf$"+$(t)},S=function(t){return function(n,i,c){var f=e({})[1],p=r(!1),y=r(),g=c.cache,h=c.initialSize,b=void 0===h?1:h,m=c.revalidateAll,x=void 0!==m&&m,S=c.persistSize,k=void 0!==S&&S,z=c.revalidateFirstPage,A=void 0===z||z,D=null;try{D=$(n)}catch(t){}var O=null,E=null;D&&(O="$ctx$"+D,E="$len$"+D);var J=u(function(){var t=g.get(E);return s(t)?b:t},[E,b]),N=r(J());d(function(){p.current?D&&g.set(E,k?N.current:b):p.current=!0},[D]);var P=t(D?"$inf$"+D:null,function(){return o(void 0,void 0,void 0,function(){var t,e,r,u,o,l,f,v,p,d,h,b;return a(this,function(a){switch(a.label){case 0:t=g.get(O)||[],e=t[0],r=t[1],u=[],o=J(),l=null,f=0,a.label=1;case 1:return f<o?(v=w(n?n(f,l):null),p=v[0],d=v[1],p?(h=g.get(p),b=x||e||s(h)||A&&!f&&!s(y.current)||r&&!s(r[f])&&!c.compare(r[f],h),i&&b?[4,i.apply(void 0,d)]:[3,3]):[3,5]):[3,5];case 2:h=a.sent(),g.set(p,h),a.label=3;case 3:u.push(h),l=h,a.label=4;case 4:return++f,[3,1];case 5:return g.delete(O),[2,u]}})})},c);d(function(){y.current=P.data},[P.data]);var T=u(function(t,n){if(void 0===n&&(n=!0),O){if(n&&!s(t)){var e=y.current;g.set(O,[!1,e])}else n&&g.set(O,[!0]);return P.mutate(t,n)}},[O]),V=u(function(t){var e;if(E&&(v(t)?e=t(J()):"number"==typeof t&&(e=t),"number"==typeof e))return g.set(E,e),N.current=e,f({}),T(function(t){for(var e=[],r=null,u=0;u<t;++u){var i=w(n?n(u,r):null)[0],o=i?g.get(i):l;if(s(o))return y.current;e.push(o),r=o}return e}(e))},[E,J,T]);return{size:J(),setSize:V,mutate:T,get error(){return P.error},get data(){return P.data},get isValidating(){return P.isValidating}}}},k=function(t,n){return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var u=m(e),i=u[0],o=u[1],a=u[2];return a.use=(a.use||[]).concat(n),t(i,o,a)}}(i,S);export{k as default,S as infinite,x as unstable_serialize};
