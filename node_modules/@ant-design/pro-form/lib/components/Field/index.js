"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectSpread2 = _interopRequireDefault(require("@babel/runtime/helpers/objectSpread2"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _react = _interopRequireWildcard(require("react"));

var _proField = _interopRequireDefault(require("@ant-design/pro-field"));

var _proUtils = require("@ant-design/pro-utils");

var _createField = _interopRequireDefault(require("../../BaseForm/createField"));

var _Dependency = _interopRequireDefault(require("../Dependency"));

var _excluded = ["fieldProps", "children", "labelCol", "label", "autoFocus", "isDefaultDom", "render", "proFieldProps", "renderFormItem", "valueType", "initialValue", "onChange", "valueEnum", "params", "name", "valuePropName"];

/**
 * 最普通的 Text 组件
 *
 * @param
 */
var ProFormField = /*#__PURE__*/_react.default.forwardRef(function (props, ref) {
  var fieldProps = props.fieldProps,
      children = props.children,
      labelCol = props.labelCol,
      label = props.label,
      autoFocus = props.autoFocus,
      isDefaultDom = props.isDefaultDom,
      render = props.render,
      proFieldProps = props.proFieldProps,
      renderFormItem = props.renderFormItem,
      valueType = props.valueType,
      initialValue = props.initialValue,
      _onChange = props.onChange,
      valueEnum = props.valueEnum,
      params = props.params,
      name = props.name,
      _props$valuePropName = props.valuePropName,
      valuePropName = _props$valuePropName === void 0 ? 'value' : _props$valuePropName,
      restProps = (0, _objectWithoutProperties2.default)(props, _excluded);
  (0, _react.useImperativeHandle)(ref, function () {
    return {};
  }); // 防止 formItem 的值被吃掉

  if (children) {
    if ( /*#__PURE__*/_react.default.isValidElement(children)) {
      return /*#__PURE__*/_react.default.cloneElement(children, (0, _objectSpread2.default)((0, _objectSpread2.default)({}, restProps), {}, {
        onChange: function onChange() {
          for (var _len = arguments.length, restParams = new Array(_len), _key = 0; _key < _len; _key++) {
            restParams[_key] = arguments[_key];
          }

          if (fieldProps === null || fieldProps === void 0 ? void 0 : fieldProps.onChange) {
            var _fieldProps$onChange;

            fieldProps === null || fieldProps === void 0 ? void 0 : (_fieldProps$onChange = fieldProps.onChange) === null || _fieldProps$onChange === void 0 ? void 0 : _fieldProps$onChange.call.apply(_fieldProps$onChange, [fieldProps].concat(restParams));
            return;
          }

          _onChange === null || _onChange === void 0 ? void 0 : _onChange.apply(void 0, restParams);
        }
      }, children.props));
    }

    return children;
  }

  var renderDom = function renderDom(values) {
    var propsParams = values ? (0, _objectSpread2.default)((0, _objectSpread2.default)({}, params), values || {}) : params;
    return /*#__PURE__*/_react.default.createElement(_proField.default, (0, _extends2.default)({
      valuePropName: valuePropName,
      text: fieldProps === null || fieldProps === void 0 ? void 0 : fieldProps[valuePropName],
      render: render,
      renderFormItem: renderFormItem,
      valueType: valueType || 'text',
      fieldProps: (0, _objectSpread2.default)((0, _objectSpread2.default)({
        autoFocus: autoFocus
      }, fieldProps), {}, {
        onChange: function onChange() {
          for (var _len2 = arguments.length, restParams = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
            restParams[_key2] = arguments[_key2];
          }

          if (fieldProps === null || fieldProps === void 0 ? void 0 : fieldProps.onChange) {
            var _fieldProps$onChange2;

            fieldProps === null || fieldProps === void 0 ? void 0 : (_fieldProps$onChange2 = fieldProps.onChange) === null || _fieldProps$onChange2 === void 0 ? void 0 : _fieldProps$onChange2.call.apply(_fieldProps$onChange2, [fieldProps].concat(restParams));
            return;
          }

          _onChange === null || _onChange === void 0 ? void 0 : _onChange.apply(void 0, restParams);
        }
      }),
      valueEnum: (0, _proUtils.runFunction)(valueEnum)
    }, proFieldProps, restProps, {
      mode: (proFieldProps === null || proFieldProps === void 0 ? void 0 : proFieldProps.mode) || 'edit',
      params: propsParams
    }));
  };

  if (restProps.dependencies && restProps.request) {
    return /*#__PURE__*/_react.default.createElement(_Dependency.default, {
      name: restProps.dependencies
    }, function (values) {
      return renderDom(values);
    });
  }

  return renderDom();
});

var _default = (0, _createField.default)(ProFormField);

exports.default = _default;